package com.smk.business.controller;

import com.smk.business.netty.client.NettyClient;
import com.smk.common.netty.constant.MsgType;
import com.smk.common.netty.constant.NettyConstant;
import com.smk.common.netty.message.RequestMsgPacket;
import com.smk.common.util.SerialNumberUtils;
import com.smk.common.vo.BaseResult;
import com.smk.common.vo.BaseResultBuilder;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

/**
 * @Description:
 * @Project: finance-parent
 * @author: liuhui
 * @version: 1.0
 * @since: JDK 1.8
 * @Date: 2019/12/31 12:10
 * Copyright (c) 2019, 96225.com.cn All Rights Reserved.
 */
@RestController
@Slf4j
@RequestMapping("/netty")
public class NettyExampleController {

    @Autowired
    private NettyClient nettyClient;

    @GetMapping("/test")
    public String test(String param) {
        RequestMsgPacket packet = new RequestMsgPacket();
        packet.setMagicNumber(NettyConstant.MAGIC_NUMBER);
        packet.setVersion(NettyConstant.VERSION);
        packet.setSerialNumber(SerialNumberUtils.getSeriaNumber());
        packet.setMsgType(MsgType.REQUEST);
        packet.setInterfaceName("com.smk.ebank.service.xy.XyExampleServiceImpl");
        if (param.equals("object")) {

            packet.setMethodName("sayHelloWithObject");
            packet.setMethodArgumentSignatures(new String[]{"com.smk.common.vo.BaseResult"});
//            packet.setMethodArgumentSignatures(new Class[]{BaseResult.class});
            BaseResult baseResult = BaseResultBuilder.buildSuccessResult();
            packet.setMethodArguments(new Object[]{baseResult});
        } else if (param.equals("void")) {
            packet.setMethodName("sayHello");
            packet.setMethodArgumentSignatures(new String[]{"java.lang.String"});
//            packet.setMethodArgumentSignatures(new Class[]{String.class});
            packet.setMethodArguments(new Object[]{"liuhui"});
        } else if (param.equals("return")) {
            packet.setMethodName("sayHelloWithReturnObject");
            packet.setMethodArgumentSignatures(new String[]{"java.lang.String"});
//            packet.setMethodArgumentSignatures(new Class[]{String.class});
            packet.setMethodArguments(new Object[]{"liuhui"});
        }
        nettyClient.sendMsg(packet);
        return "hello";
    }

}
